<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>1200 ELO Chess Bot - Pure Code Pieces</title>
    <link rel="stylesheet" href="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.css">
    <style>
        body { 
            font-family: Arial, sans-serif; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            margin-top: 50px; 
            background-color: #f4f4f9;
        }
        #myBoard { 
            width: 400px; 
            max-width: 100%; 
            touch-action: none; 
        }
        .status { margin-top: 20px; font-size: 1.2rem; font-weight: bold; }
        .explanation { margin-top: 10px; color: #555; max-width: 400px; text-align: center; }

        .highlight-selected { background-color: rgba(155, 199, 0, 0.6) !important; }
        .highlight-legal { position: relative; }
        .highlight-legal::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 25%;
            height: 25%;
            background-color: rgba(0, 0, 0, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            pointer-events: none; 
        }
    </style>
</head>
<body>

    <h2>Play White vs. an ~1200 ELO Bot</h2>
    <div id="myBoard"></div>
    <div class="status" id="status">Your turn (White)</div>
    <p class="explanation">Tap a piece, then tap a dot. Pieces are generated with code, so they will always load!</p>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://unpkg.com/@chrisoakman/chessboardjs@1.0.0/dist/chessboard-1.0.0.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chess.js/0.10.3/chess.min.js"></script>

    <script>
        var board = null;
        var game = new Chess();
        var $status = $('#status');
        var $board = $('#myBoard');
        
        var squareClass = 'square-55d63';
        var selectedSquare = null;

        var pieceValues = { 'p': 10, 'n': 30, 'b': 30, 'r': 50, 'q': 90, 'k': 900 };

        function evaluateBoard(game) {
            var totalEvaluation = 0;
            var boardArray = game.board();
            for (var i = 0; i < 8; i++) {
                for (var j = 0; j < 8; j++) {
                    if (boardArray[i][j] !== null) {
                        var val = pieceValues[boardArray[i][j].type];
                        totalEvaluation += boardArray[i][j].color === 'w' ? val : -val;
                    }
                }
            }
            return totalEvaluation;
        }

        function minimax(game, depth, alpha, beta, isMaximizingPlayer) {
            if (depth === 0 || game.game_over()) return evaluateBoard(game);

            var possibleMoves = game.moves();

            if (isMaximizingPlayer) {
                var bestVal = -9999;
                for (var i = 0; i < possibleMoves.length; i++) {
                    game.move(possibleMoves[i]);
                    bestVal = Math.max(bestVal, minimax(game, depth - 1, alpha, beta, !isMaximizingPlayer));
                    game.undo();
                    alpha = Math.max(alpha, bestVal);
                    if (beta <= alpha) break;
                }
                return bestVal;
            } else {
                var bestVal = 9999;
                for (var i = 0; i < possibleMoves.length; i++) {
                    game.move(possibleMoves[i]);
                    bestVal = Math.min(bestVal, minimax(game, depth - 1, alpha, beta, !isMaximizingPlayer));
                    game.undo();
                    beta = Math.min(beta, bestVal);
                    if (beta <= alpha) break;
                }
                return bestVal;
            }
        }

        function makeBotMove() {
            var possibleMoves = game.moves();
            if (possibleMoves.length === 0) return;

            var bestMove = null;
            var bestValue = 9999; 

            for (var i = 0; i < possibleMoves.length; i++) {
                var move = possibleMoves[i];
                game.move(move);
                var boardValue = minimax(game, 2, -10000, 10000, true);
                game.undo();
                
                if (boardValue < bestValue) {
                    bestValue = boardValue;
                    bestMove = move;
                }
            }

            if (!bestMove) bestMove = possibleMoves[Math.floor(Math.random() * possibleMoves.length)];

            game.move(bestMove);
            board.position(game.fen());
            updateStatus();
        }
        
        function removeHighlights() {
            $board.find('.' + squareClass).removeClass('highlight-selected');
            $board.find('.' + squareClass).removeClass('highlight-legal');
        }

        function highlightLegalMoves(square) {
            var moves = game.moves({ square: square, verbose: true });
            for (var i = 0; i < moves.length; i++) {
                $board.find('.square-' + moves[i].to).addClass('highlight-legal');
            }
        }

        $board.on('click', '.' + squareClass, function () {
            if (game.game_over() || game.turn() === 'b') return;

            var square = $(this).attr('data-square');
            var piece = game.get(square);

            if (selectedSquare) {
                var moves = game.moves({ square: selectedSquare, verbose: true });
                var isLegalMove = moves.find(m => m.to === square);

                if (isLegalMove) {
                    game.move({ from: selectedSquare, to: square, promotion: 'q' });
                    board.position(game.fen());
                    removeHighlights();
                    updateStatus();
                    selectedSquare = null;
                    
                    window.setTimeout(makeBotMove, 250);
                    return;
                }
            }

            if (piece && piece.color === 'w') {
                selectedSquare = square;
                removeHighlights();
                $(this).addClass('highlight-selected');
                highlightLegalMoves(square);
            } else {
                selectedSquare = null;
                removeHighlights();
            }
        });

        function updateStatus () {
            var statusHTML = '';
            var moveColor = game.turn() === 'b' ? 'Black' : 'White';

            if (game.in_checkmate()) {
                statusHTML = 'Game over, ' + moveColor + ' is in checkmate.';
            } else if (game.in_draw()) {
                statusHTML = 'Game over, drawn position';
            } else {
                statusHTML = moveColor + ' to move';
                if (game.in_check()) {
                    statusHTML += ', ' + moveColor + ' is in check';
                }
            }
            $status.html(statusHTML);
        }

        var config = {
            draggable: false, 
            position: 'start',
            // --- THIS IS THE MAGIC FIX ---
            // It generates the pieces using standard Unicode characters inside of SVG code!
            pieceTheme: function(piece) {
                var solidMap = {
                    'wK': '♚', 'wQ': '♛', 'wR': '♜', 'wB': '♝', 'wN': '♞', 'wP': '♟',
                    'bK': '♚', 'bQ': '♛', 'bR': '♜', 'bB': '♝', 'bN': '♞', 'bP': '♟'
                };
                
                var fill = piece.charAt(0) === 'w' ? '#ffffff' : '#000000';
                // Gives a black outline to white pieces, and a white outline to black pieces so they pop!
                var stroke = piece.charAt(0) === 'w' ? '#000000' : '#ffffff'; 
                var strokeWidth = piece.charAt(0) === 'w' ? '1.5' : '1';
                
                var svg = '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40">' +
                          '<text x="50%" y="50%" font-size="36" dy="0.35em" ' +
                          'text-anchor="middle" ' +
                          'fill="' + fill + '" stroke="' + stroke + '" stroke-width="' + strokeWidth + '">' +
                          solidMap[piece] +
                          '</text></svg>';
                
                return 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(svg);
            }
        };
        
        board = Chessboard('myBoard', config);
        updateStatus();
    </script>
</body>
</html>
